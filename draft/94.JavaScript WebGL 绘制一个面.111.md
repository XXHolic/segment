# 94.JavaScript WebGL 绘制一个面.111
## <a name="index"></a> 目录
- [引子](#start)
- [绘制三角形](#triangle)
- [高清处理](#hd)
- [绘制矩形](#rectangle)
- [参考资料](#reference)

## <a name="start"></a> 引子
[JavaScript WebGL 基础疑惑点][url-pre]之后进行了一些优化，然后尝试绘制常见二维的面。

WebGL 中几何体最终都是由三角形构成，由三角形切入比较合适。

## <a name="triangle"></a> 绘制三角形
这是[示例][url-9]，基于[绘制一条直线][url-5]主要的变化有：

### 顶点
三角形有三个顶点，在[基础疑惑点][url-pre]中知道坐标系是右手坐标系，个人习惯描述顶点的顺序以图形中心为原点，从第一象限到第四象限。
```js
  let vertices = [
    0.5, 0.5, 0.0, // 第一象限
    -0.5, 0.5, 0.0, // 第二象限
    -0.5, -0.5, 0.0, // 第三象限
  ]; // 三角形
```

### 绘制图元
这次绘制的是一个面，[drawArrays][url-6] 中绘制模式变为 `gl.TRIANGLES` 。顺便看看图元的几种模式。

- gl.POINTS ： 绘制一系列点。
- gl.LINES ：绘制一系列单独线段，每两个点作为端点，线段之间不连接。例如有顶点 A、B、C、D、E、F，就会得到了三条线段。

![94-lines][url-local-1]

- gl.LINE_STRIP ： 绘制一系列线段，上一点连接下一点。

![94-line-strip][url-local-2]

- gl.LINE_LOOP ： 绘制一系列线段，上一点连接下一点，并且最后一点与第一个点相连。

![94-line-loop][url-local-3]

- gl.TRIANGLES ： 绘制一系列三角形，每三个点作为顶点。例如有 6 个顶点 A、B、C、D、E、F，就会绘制 2 个三角形： ABC 和 DEF。

![94-triangles][url-local-4]

- gl.TRIANGLE_STRIP ： 用来绘制有共享边的三角形。从第二个三角形开始，每次读取一个顶点，并利用前面的末尾两个顶点构成一个三角形，以此类推。例如有 6 个顶点 A、B、C、D、E、F，就会绘制 4 个三角形： ABC 和 BCD 和 CDE 和 DEF。

![94-triangle-strip][url-local-5]

- gl.TRIANGLE_FAN ： 绘制有共享边的三角形。从第二个三角形开始，每次读取一个顶点，并利用首个顶点和之前最后一个顶点来构成一个三角形，以此类推。例如有 6 个顶点 A、B、C、D、E、F，就会绘制 4 个三角形： ABC 和 ACD 和 ADE 和 AEF。

![94-triangle-fan][url-local-6]

## <a name="hd"></a> 高清处理
上面的示例，在高清屏幕中会出现明显的模糊和锯齿，但跟处理 `2d` 上下文的模糊又有些不一样。最主要的一个区别是 WebGL 中需要用 [viewport][url-8] 方法指定从标准设备到窗口坐标的映射变换。详细可以见[这篇文章][url-7]里面的解释。

这是[高清示例][url-10]。

```js
  function WebGLHD(w = 300, h = 150) {
    const ratio = window.devicePixelRatio || 1;
    const canvas = document.createElement("canvas");
    const context = canvas.getContext("webgl");
    // 高清屏幕模糊问题处理
    canvas.width = w * ratio; // 实际渲染像素
    canvas.height = h * ratio; // 实际渲染像素
    canvas.style.width = `${w}px`; // 控制显示大小
    canvas.style.height = `${h}px`; // 控制显示大小
    context.viewport(0, 0, context.canvas.width, context.canvas.height);
  }
```

## <a name="rectangle"></a> 绘制矩形
前面有说 WebGL 中几何体最终都是由三角形构成，在绘制多边形的时候需要分解为多个三角形。

这是[示例][url-11]，一个矩形可以分为两个三角形：
```js
  let vertices = [
    0.5, 0.5, 0.0,
    -0.5, 0.5, 0.0,
    -0.5, -0.5, 0.0, // 第一个三角形
    -0.5, -0.5, 0.0,
    0.5, -0.5, 0.0,
    0.5, 0.5, 0.0, // 第二个三角形
  ]; // 矩形
```

<div align="right"><a href="#index">Back to top :arrow_up:</a></div>


## <a name="reference"></a> 参考资料
- [WebGL基础绘制之二：绘制三角形][url-4]
- [WebGL lessons][url-2]
- [你好，三角形][url-3]
- [WebGL 1.0 官方索引卡片][url-1]

[url-pre]:https://github.com/XXHolic/segment/issues/110
[url-1]:https://www.khronos.org/files/webgl/webgl-reference-card-1_0.pdf
[url-2]:https://webglfundamentals.org/
[url-3]:https://learnopengl-cn.github.io/01%20Getting%20started/04%20Hello%20Triangle/
[url-4]:http://www.jiazhengblog.com/blog/2016/02/19/2910/
[url-5]:https://github.com/XXHolic/segment/issues/109
[url-6]:https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/drawArrays
[url-7]:https://webglfundamentals.org/webgl/lessons/webgl-resizing-the-canvas.html
[url-8]:https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/viewport
[url-9]:https://xxholic.github.io/lab/segment/94/blur.html
[url-10]:https://xxholic.github.io/lab/segment/94/index.html
[url-11]:https://xxholic.github.io/lab/segment/94/rectangle.html


[url-local-1]:../images/94/1.png
[url-local-2]:../images/94/2.png
[url-local-3]:../images/94/3.png
[url-local-4]:../images/94/4.png
[url-local-5]:../images/94/5.png
[url-local-6]:../images/94/6.png

<details>
<summary>:wastebasket:</summary>

最近看了一部作品[《迪丽丽的奇幻巴黎》][url-poster]，里面人物服饰华丽又有特色，场景建筑也很精致。
故事表达了一种积极向上的态度，但剧情里面碰到的人大都非富即贵，的确有些奇幻。

![94-poster][url-local-poster]

</details>

[url-poster]:https://movie.douban.com/subject/26695000/
[url-local-poster]:../images/94/poster.png


